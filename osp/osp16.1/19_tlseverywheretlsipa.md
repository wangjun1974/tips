### 
https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/16.1/html/advanced_overcloud_customization/sect-tripleo-ipa

```
# 确认 /etc/resolv.conf 文件指向 ipa dns 
(undercloud) [stack@undercloud ~]$ cat /etc/resolv.conf 
# Generated by NetworkManager
search example.com
nameserver 192.168.122.3

# 安装所需软件 python3-ipalib python3-ipaclient 和 krb5-devel
(undercloud) [stack@undercloud ~]$ sudo dnf install -y python3-ipalib python3-ipaclient krb5-devel

# 设置环境变量
(undercloud) [stack@undercloud ~]$ 
export IPA_USER=admin
export IPA_PASSWORD='redhat123'
export IPA_DOMAIN=example.com
export IPA_REALM=EXAMPLE.COM
export IPA_ADMIN_USER=$IPA_USER
export IPA_ADMIN_PASSWORD=$IPA_PASSWORD
export IPA_SERVER_HOSTNAME=helper.example.com
export UNDERCLOUD_FQDN=undercloud.example.com
export USER=stack
export CLOUD_DOMAIN=example.com

# 运行 playbook undercloud-ipa-install.yaml
(undercloud) [stack@undercloud ~]$ ansible-playbook \
--ssh-extra-args "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null" \
/usr/share/ansible/tripleo-playbooks/undercloud-ipa-install.yaml

# 编辑 undercloud.conf 文件，包含 overcloud_domain_name 和 undercloud_nameservers
# 不包含 enable_novajoin 和 ipa_otp
(undercloud) [stack@undercloud ~]$ diff -urN undercloud.conf.novajoin undercloud.conf 
--- undercloud.conf.novajoin    2021-11-03 10:39:34.349105726 +0800
+++ undercloud.conf     2021-11-03 10:39:51.291105726 +0800
@@ -16,10 +16,8 @@
 enable_tempest = false
 enable_ui = false
 clean_nodes=true
-enable_novajoin = true
 overcloud_domain_name = example.com
 undercloud_nameservers = 192.168.122.3
-ipa_otp = 3CshifbPNJKuFEzOGr5qxm4nr3xWKE6wqC9FUUqYmcjO
 
 
 [auth]

# 重新部署 undercloud
openstack undercloud install

# 生成所需 tls-parameters.yaml 模版
cat > ~/templates/tls-parameters.yaml <<EOF
resource_registry:
  OS::TripleO::Services::IpaClient: /usr/share/openstack-tripleo-heat-templates/deployment/ipa/ipaservices-baremetal-ansible.yaml
parameter_defaults:
  DnsSearchDomains: ["example.com"]
  DnsServers: ["192.168.122.3"]
  CloudDomain: example.com
  CloudName: overcloud.example.com
  CloudNameInternal: overcloud.internalapi.example.com
  CloudNameStorage: overcloud.storage.example.com
  CloudNameStorageManagement: overcloud.storagemgmt.example.com
  CloudNameCtlplane: overcloud.ctlplane.example.com
  IdMModifyDNS: True
  IdMServer: 192.168.122.3
  IdMDomain: example.com
  IdMInstallClientPackages: False
EOF


```